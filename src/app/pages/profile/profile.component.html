<app-header></app-header>

<div class="container mt-5">
  <div style="height: auto; min-height: 45rem" class="p-5 shadow-lg bg-white">
    <div *ngIf="!isLoad" [@slideInBottom]>
      <div class="row">
        <div class="col-4 d-flex justify-content-center">
          <div style="width: 200px; height: 200px" class="avatar">
            <img
              style="object-fit: cover; object-position: center"
              class="w-100 h-100 rounded-circle"
              [src]="user.AvatarURL"
              alt=""
            />
          </div>
        </div>
        <div class="col-8">
          <div class="row">
            <div class="col">
              <span class="fw-bold fs-2">{{ user.display_name }}</span>
            </div>
            <div class="col d-flex flex-row gap-1 to-col">
              <div>
                <button
                  style="width: 9.5rem; height: 2.5rem"
                  routerLink="/edit_profile"
                  mat-stroked-button
                >
                  <div class="d-flex flex-row gap-1 align-items-center">
                    <div style="height: 1.5rem; width: 1.5rem">
                      <mat-icon
                        class="fs-4 h-100 w-100"
                        aria-hidden="false"
                        fontIcon="manage_accounts"
                      ></mat-icon>
                    </div>
                    <div><span>EditProfile</span></div>
                  </div>
                </button>
              </div>
              <div>
                <label for="avatarUpload" class="button-label">
                  <div
                    style="width: 9.5rem; height: 2.5rem"
                    class="button-container text-center"
                  >
                    <div class="d-flex flex-row gap-1 align-items-center">
                      <div style="height: 1.5rem; width: 1.5rem">
                        <mat-icon
                          class="fs-4 h-100 w-100"
                          aria-hidden="false"
                          fontIcon="add_photo_alternate"
                        ></mat-icon>
                      </div>
                      <div><span>Change Avatar</span></div>
                    </div>
                    <input
                      type="file"
                      id="avatarUpload"
                      (change)="changeAvatar($event)"
                      style="display: none"
                    />
                  </div>
                </label>
              </div>
            </div>
          </div>
          <hr />
          <div
            *ngIf="!isPutBio"
            style="min-width: 100%"
            class="d-flex flex-row gap-2 w-auto"
          >
            <div>
              <p class="fw-semibold">{{ user.Bio }}</p>
            </div>
            <div>
              <mat-icon
                style="cursor: pointer"
                class="fs-4 h-100"
                aria-hidden="false"
                fontIcon="edit_square"
                (click)="isPutBio = true"
              ></mat-icon>
            </div>
          </div>
          <div *ngIf="isPutBio">
            <mat-form-field
              appearance="outline"
              class="w-75 dense-4 form"
              color="primary"
            >
              <mat-label>Change Your Bio</mat-label>
              <div class="d-flex align-items-center gap-1 to-col">
                <input matInput #input required />
                <span class="flex-grow-1"></span>
                <!-- This creates a flexible space to push icons to the right -->
                <mat-icon
                  style="cursor: pointer"
                  (click)="onDoneClick(input)"
                  class="mr-2"
                  fontIcon="done"
                ></mat-icon>
                <mat-icon
                  style="cursor: pointer"
                  (click)="onCloseClick()"
                  fontIcon="close"
                  color="warn"
                ></mat-icon>
              </div>
            </mat-form-field>
          </div>
        </div>
      </div>
      <hr class="my-5" />
      <div class="row row-cols-2 row-cols-lg-5 g-2 g-lg-3 text-center">
        <div *ngFor="let item of userImg; let i = index" class="col">
          <div>
            <div *ngIf="item; else elseBlock">
              <div
                style="height: 18rem; position: relative"
                class="w-100 border border-2 border-black"
                (mouseenter)="toggleHoverState(i)"
                (mouseleave)="toggleHoverState(i)"
              >
                <img
                  style="object-fit: cover; object-position: center"
                  class="w-100 h-100"
                  [src]="item.ImageURL"
                  alt=""
                  [ngClass]="{ 'blur-image': hoverStates[i] }"
                />
                <button
                  *ngIf="hoverStates[i]"
                  mat-raised-button
                  style="top: 40%"
                  class="position-absolute start-50 translate-middle w-75"
                >
                  <label
                    for="fileInput"
                    style="cursor: pointer"
                    class="d-flex flex-column align-items-center"
                  >
                    <div class="d-flex align-items-center">
                      <mat-icon
                        class="fs-5 h-100"
                        aria-hidden="false"
                        fontIcon="autorenew"
                      ></mat-icon>
                      <span>Change Image</span>
                    </div>

                    <input
                      type="file"
                      id="fileInput"
                      (change)="changeImg($event, item.ImageID)"
                      style="display: none"
                    />
                  </label>
                </button>
                <button
                  *ngIf="hoverStates[i]"
                  mat-raised-button
                  color="warn"
                  style="top: 55%"
                  class="position-absolute start-50 translate-middle w-75"
                  (click)="deleteImg(item.ImageID)"
                >
                  <mat-icon
                    class="fs-5"
                    aria-hidden="false"
                    fontIcon="delete"
                  ></mat-icon>
                  Delete Image
                </button>
              </div>
              <div
                class="d-flex align-items-center justify-content-center mt-2"
              >
                <mat-icon
                  aria-hidden="false"
                  fontIcon="favorite"
                  color="accent"
                ></mat-icon>
                <span class="fw-semibold">{{ item.EloScore }}</span>
              </div>
            </div>
            <ng-template #elseBlock>
              <div
                style="height: 18rem"
                class="w-100 border border-2 border-black d-flex justify-content-center align-items-center"
              >
                <input
                  type="file"
                  (change)="uploadImg($event)"
                  style="display: none"
                  #fileInput
                />
                <div
                  (click)="fileInput.click()"
                  style="height: 50px; width: 50px; cursor: pointer"
                  class="d-flex justify-content-center align-items-center border border-black rounded-circle"
                >
                  <mat-icon fontIcon="add"></mat-icon>
                </div>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
    <div
      *ngIf="isLoad"
      style="height: 40rem"
      class="d-flex justify-content-center align-items-center"
    >
      <img
        src="https://i.pinimg.com/originals/13/90/75/13907559a21dd41293af7c57a89b3849.gif"
        alt=""
      />
    </div>
  </div>
</div>
<div>
  <br />
  <br />
</div>
